<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<dom-module id="tm-twisty-puzzle">

  <template>
    <style>
      :host {
        display: inline-block;
      }
      .cube {
        display: inline-block;
        width: 360px;
        height: 360px;
        border:solid lightgrey 2px;
      }
    </style>
    <div id="cube" class="cube" data-moves$="[[setup]]"></div>
  </template>

  <script>
    class TwistyPuzzle extends Polymer.Element {
      static get is() {
        return 'tm-twisty-puzzle';
      }
      static get properties() {
        return {
          size: {
            type:Number,
            notify:true,
            reflectToAttribute: true,
            value:3
          },
          powerSaveMode: {
            type:Boolean,
            notify:true,
            reflectToAttribute: true,
            value:1,
            observer:'_powerSaveModeChanged'
          },
          algDelay: {
            type:Number,
            notify:true,
            reflectToAttribute: true,
            value:1000
          },
          inspectDelay: {
            type:Number,
            notify:true,
            reflectToAttribute: true,
            value:2000
          },
          setup: {
            type: String,
            notify: true,
            reflectToAttribute: true,
            value: "(R R L' L') y (R R L' L') z (R R L' L')"
          },
          look: {
            type: String,
            notify: true,
            reflectToAttribute: true,
            value: "(R R L' L') y (R R L' L') z (R R L' L')"
          },
          alg: {
            type: String,
            notify: true,
            reflectToAttribute: true,
            value: "x x x x x y y y z z z z z z"
          }
        }
      }
      _powerSaveModeChanged() {
        if (this.cube) {
          this.cube.setPowerSaveMode(this.powerSaveMode);
        }
      }
      reset() {
        this.cube.reset();
        var ms = this.cube.data("move-stack");
        console.log('MOVE STACK: ', ms);
        if (ms) {
          while(ms.length > 0) {
              ms.pop();
          }
        }
        //this.cube.delay(0);
        const resetDelay = 0;
        this.cube.delay(resetDelay);
        this.cube.execute(this.setup);
      }
      run() {
        //this.cube.delay(this.algDelay);
        const runDelay = this.algDelay;
        this.cube.delay(runDelay);
        this.cube.execute(this.alg);
      }
      inspectCube() {
        //this.cube.delay(this.inspectDelay);
        const inspectDelay = parseInt(this.inspectDelay);
        this.cube.delay(inspectDelay);
        this.cube.execute(this.look);
      }
      _build() {
        var self = this;
        console.log('Creating Cube');
        var el = self.shadowRoot.querySelector('#cube');
        this.cube = $(el).cube({
          type:this.size,
          animation: {delay: 0},
          background:0xFFFFFF,
          onComplete:function() {
            console.log('Algorithm has completed.');
          }
        });
      }

      ready() {
        super.ready();
        this._build();
      }
      constructor() {
        super();
      }
    }

    customElements.define(TwistyPuzzle.is, TwistyPuzzle);
  </script>

</dom-module>
